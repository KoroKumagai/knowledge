---
title: 日本企業における環境とブランチ戦略の現実解
tags: [開発プロセス管理, Git, 環境設計, 品質保証]
---

# 環境とブランチ戦略の整理

## 理想的な環境構成
システム開発においては、次の4環境を分けるのが理想とされる。

- **開発 (Dev)**：開発者が自由に実装・動作確認を行う場
- **検証 (Staging/Test)**：本番に近い構成で結合・外部連携を検証する場
- **QA (Quality Assurance/UAT)**：品質保証チームやユーザー代表が受け入れテストを行う場
- **本番 (Prod)**：実際のユーザーが利用する環境

👉 ただし、予算や体制によっては **検証と本番の2つ** しか存在しないケースも珍しくない。

---

## 世界的な主流：TBD (Trunk-Based Development)
- **長命ブランチは `main` のみ**
- 機能追加は `feat/*`、修正は `fix/*` の短命ブランチから PR → `main` に統合
- **一度だけビルドしたアーティファクトを Dev → Stg → QA → Prod と昇格**
- 機能の出し分けは **Feature Flag** で制御
- 緊急Hotfixは **Prodタグから派生した `hotfix/*`** を使い、リリース後に `main` へバックマージ

👉 SaaSや自社開発に向いており、リリースサイクルが速く、変更の再現性が高い。

---

## 日本企業で根強い：GitFlow系
- **複数の長命ブランチ**を運用する  
  - `develop` → 開発統合
  - `release/*` → リリース候補
  - `main` → 本番
- 環境はしばしば **開発 / ステージング / 本番の3つだけ**
- 本番リリースには **複数オーナーの承認が必要**というケースが多い
- 緊急Hotfixは `main` から `hotfix/*` を切り、本番に即適用 → 後追いで `develop` / `release/*` に逆マージ

👉 監査や検収プロセスが厳格な案件に適しているが、**逆マージ地獄**が課題。

---

## SES案件でよくある制約
- **環境は3つのみ（Dev / Stg / Prod）**
- **複数オーナーが同じStagingを共有**
- **全オーナーの承認が揃わないとProdに進めない**
- IT予算の制約で環境を分けられない

### このときの課題
- AオーナーはOKでも、Bオーナーが多忙で承認できないとリリース全体が止まる
- 緊急Hotfixが必要でも、Stagingに未承認機能が混在してしまう

---

## 折衷案（現実解）
### 1. Feature Flag の導入
- 新機能をStaging/Prodにデプロイしても **フラグOFF**で非活性化
- 各オーナーがStagingでフラグONにして受け入れテスト
- Prodでは両オーナーの承認が揃ったらフラグON

### 2. タグベースの昇格
- `main` からリリース候補タグ（例：`rc-A202509`）を切り、Stagingにデプロイ
- Aオーナー承認後に `rc-B202509` を作りBオーナーがテスト
- 両者がOKなら、同じコミットに正式タグ（`v1.4.0`）を付与してProd昇格

### 3. 緊急Hotfix専用の経路
- **ProdタグからHotfixブランチを切る**
- 修正後にStagingで最低限の確認をしてProdへ昇格
- その後 `main` および未完了の `release/*` にバックマージ

---

## まとめ
- **理想**：4環境＋TBD（SaaSや自社開発向き）
- **現実**：3環境＋GitFlow（大企業SES向き）
- **折衷案**：Feature Flag／タグ昇格／Hotfix例外ルールでリスクを吸収

👉 この領域は **「開発プロセス管理」** に属するが、**品質保証や運用設計とも密接に関連**する。  
👉 自社サービスならTBD、大企業SESならGitFlow寄り、と割り切るのが実務的な選択となる。
